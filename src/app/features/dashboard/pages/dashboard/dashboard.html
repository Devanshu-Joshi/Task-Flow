<div class="page-wrapper" [class.loading]="isLoading()">
    <!-- your entire dashboard UI -->
    <div class="min-h-full w-full bg-linear-to-r from-purple-600 via-fuchsia-600 to-indigo-600 flex items-center flex-col px-4 sm:px-6 lg:px-7
         py-4 sm:py-6 lg:py-7
         gap-6 sm:gap-8">

        <!-- Stats Card Component -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">

            <app-stats-card title="Total Tasks" [value]="totalTasks()" subtitle="Tasks created so far" icon="bx-list-ul"
                theme="purple" />

            <app-stats-card title="Completed Tasks" [value]="completedTasks()" subtitle="Great job!"
                icon="bx-check-circle" theme="green" />

            <app-stats-card title="In Progress Tasks" [value]="inProgressTasks()" subtitle="Keep going!"
                icon="bx-loader-dots" theme="yellow" />

            <app-stats-card title="Incomplete Tasks" [value]="incompleteTasks()" subtitle="Needs attention"
                icon="bx-x-circle" theme="red" />

        </div>


        <div class="w-full bg-white rounded-lg px-10 pb-10 pt-7">

            <!-- Task Filters Component -->

            <app-task-filters [statusOptions]="statusOptions" [pageSizeOptions]="pageSizeOptions"
                [searchControl]="searchControl" [(dateRange)]="dateRange" [(selectedStatus)]="selectedStatus"
                [(selectedPageSize)]="selectedPageSize" (pageSizeChangeTrigger)="setItemsPerPage($event)"
                (addTask)="toggleDialog()">
            </app-task-filters>

            <!-- Task Table Component -->

            <app-task-table [tasks]="filteredTasks()" [itemsPerPage]="itemsPerPage" [currentPage]="p"
                [sortField]="sortField()" [sortDirection]="sortDirection()" (editTask)="edit($event)"
                (deleteTask)="delete($event)" (pageChange)="p = $event" (clearFilters)="clearFilters()"
                (sortByChange)="sortBy($event)">
            </app-task-table>

        </div>

        <app-task-dialog [open]="isDialogClosed == false" (close)="toggleDialog()">

            <div class="px-8 pt-8 pb-4 text-center">
                <p class="text-2xl font-semibold tracking-tight"
                    [ngClass]="{'text-black': dialogTitleColor() === 'text-primary','text-yellow-500': dialogTitleColor() === 'text-warn','text-red-600': dialogTitleColor() === 'text-danger'}">
                    {{dialogTitle()}} Task
                </p>
                <p class="text-sm text-gray-500 mt-1">
                    {{dialogDescription()}}
                </p>
            </div>

            <form [formGroup]="taskForm" (ngSubmit)="submit()" class="px-8 pb-8">

                <div class="flex items-center gap-2 border border-gray-300 rounded-xl px-3 py-2 my-3
                       focus-within:border-indigo-500 focus-within:ring-2 focus-within:ring-indigo-500/20 transition">
                    <i class='bx bx-edit text-gray-400'></i>
                    <input type="text" formControlName="title" class="w-full outline-none text-sm placeholder-gray-400"
                        placeholder="Task Name" [ngClass]="{
                            'cursor-not-allowed': isDeleting(),
                            'cursor-auto': !isDeleting()
                        }" />
                </div>

                @if(taskForm.controls.title.touched && taskForm.controls.title.invalid) {
                <p class="text-red-500 text-xs mt-1">
                    Task name is required (min 3 chars)
                </p>
                }

                <div class="flex items-center gap-2 border border-gray-300 rounded-xl px-3 py-2 my-4
                       focus-within:border-indigo-500 focus-within:ring-2 focus-within:ring-indigo-500/20 transition">
                    <i class='bx bx-calendar text-gray-400'></i>
                    <input type="date" formControlName="dueDate" class="w-full outline-none text-sm" [ngClass]="{
                            'cursor-not-allowed': isDeleting(),
                            'cursor-auto': !isDeleting()
                        }" />
                </div>

                @if(taskForm.controls.dueDate.touched && taskForm.controls.dueDate.invalid) {
                <p class="text-red-500 text-xs mt-1">
                    Due date is required
                </p>
                }

                <div class="flex items-center gap-2 border border-gray-300 rounded-xl px-3 py-2 my-4
                       focus-within:border-indigo-500 focus-within:ring-2 focus-within:ring-indigo-500/20 transition">
                    <i class='bx bx-flag text-gray-400'></i>
                    <select formControlName="status" class="w-full outline-none text-sm bg-transparent" [ngClass]="{
                            'cursor-auto': !isDeleting(),
                            'cursor-not-allowed': isDeleting(),
                        }">
                        <option value="Incomplete">Incomplete</option>
                        <option value="Completed">Completed</option>
                        <option value="InProgress">In Progress</option>
                    </select>
                </div>

                <div class="mt-8 flex gap-3">
                    <button type="button" (click)="cancelDialog()" class="w-full py-3 rounded-xl font-medium
               text-gray-700 bg-gray-100
               hover:bg-gray-200
               transition-all duration-200 cursor-pointer">
                        Cancel
                    </button>

                    <button type="submit"
                        [ngClass]="{'submit-btn text-white': dialogTitleColor() === 'text-primary','edit-btn text-white': dialogTitleColor() === 'text-warn','delete-btn text-white': dialogTitleColor() === 'text-danger'}"
                        [disabled]="taskForm.invalid">
                        {{dialogSubmitText()}} Task
                    </button>

                </div>

            </form>
        </app-task-dialog>
    </div>
</div>

<div class="loader-overlay" *ngIf="isLoading()">
    <div class="spinner"></div>
    <p>Loading tasksâ€¦</p>
</div>