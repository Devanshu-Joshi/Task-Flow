<div class="flex flex-col h-screen bg-gray-50 p-6 overflow-hidden">

    <h2 class="text-2xl font-bold text-gray-800 mb-6">Task Board</h2>

    <!-- BOARD -->
    <div class="flex flex-row gap-6 flex-1 overflow-x-auto" cdkDropListGroup style="align-items: flex-start;">

        <!-- INCOMPLETE -->
        <div #col
            class="flex flex-col flex-1 min-w-70 bg-gray-100 rounded-xl shadow-sm border border-gray-200 overflow-hidden"
            style="min-width:320px; min-height:0; max-height:85vh;">
            <div class="p-4 border-b border-gray-200 flex justify-between items-center bg-white">
                <h3 class="font-bold text-red-700">Incomplete</h3>
                <span class="bg-red-200 text-red-700 text-xs px-2 py-1 rounded-full">
                    {{ incompleteList.length }}
                </span>
            </div>

            <div #list id="incompleteList" cdkDropList cdkScrollable [cdkDropListData]="incompleteList"
                class="relative flex-1 p-4 overflow-y-auto space-y-3 min-h-60" (cdkDropListDropped)="drop($event)"
                style="min-height: 0;">

                @for (item of incompleteList; track item.id) {
                <div cdkDrag (cdkDragMoved)="onDragMove($event)" (cdkDragEnded)="onDragEnded()"
                    class="relative bg-white p-4 rounded-lg shadow-sm border-l-4 border-red-500 hover:shadow-md transition-shadow group">
                    <p class="text-gray-800 font-medium wrap-break-word pr-14">
                        {{ item.title }}
                    </p>

                    <div class="flex items-center justify-between mt-2 text-xs">
                        <div class="flex items-center gap-1 text-gray-500">
                            <i class='bx bx-calendar'></i>
                            <span>Due : {{ item.dueDate | date:'MMM d' }}</span>
                        </div>

                        <span class="px-2 py-0.5 rounded-full font-semibold" [ngClass]="{
              'bg-red-100 text-red-700': item.priority === 'HIGH',
              'bg-yellow-100 text-yellow-700': item.priority === 'NORMAL',
              'bg-green-100 text-green-700': item.priority === 'LOW'
          }">
                            {{ item.priority }}
                        </span>
                    </div>

                    <div
                        class="absolute top-2 right-2 flex gap-2 opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-opacity">
                        <button (click)="edit(item)"
                            class="rounded-md bg-blue-50 hover:bg-blue-100 text-blue-600 shadow-sm cursor-pointer">
                            <i class='bx bx-edit text-base'></i>
                        </button>
                        <button (click)="delete(item)"
                            class="rounded-md bg-red-50 hover:bg-red-100 text-red-600 shadow-sm cursor-pointer">
                            <i class='bx bx-trash text-base'></i>
                        </button>
                    </div>
                </div>
                }

                @if (incompleteList.length === 0) {
                <div class="empty-state absolute inset-0 flex flex-col items-center justify-center text-center
                      pointer-events-none rounded-xl border-2 border-dashed
                      border-red-200 bg-red-50/40 px-4">

                    <p class="font-semibold text-gray-700 mb-1">No Incomplete Tasks</p>
                    <p class="text-xs text-gray-500 mb-3">Tasks you haven't started will appear here.</p>

                    <button (click)="toggleDialog()"
                        class="pointer-events-auto mt-2 text-sm bg-red-600 hover:bg-red-700 text-white px-4 py-1.5 rounded-md shadow-sm cursor-pointer">
                        + Add Task
                    </button>
                </div>
                }
            </div>
        </div>

        <!-- IN PROGRESS -->
        <div #col
            class="flex flex-col flex-1 min-w-70 bg-gray-100 rounded-xl shadow-sm border border-gray-200 overflow-hidden"
            style="min-width:320px; min-height:0; max-height:85vh;">
            <div class="p-4 border-b border-gray-200 flex justify-between items-center bg-white">
                <h3 class="font-bold text-yellow-600">In Progress</h3>
                <span class="bg-yellow-100 text-yellow-600 text-xs px-2 py-1 rounded-full">
                    {{ inProgressList.length }}
                </span>
            </div>

            <div #list id="inProgressList" cdkDropList cdkScrollable [cdkDropListData]="inProgressList"
                class="relative flex-1 p-4 overflow-y-auto space-y-3 min-h-60" (cdkDropListDropped)="drop($event)"
                style="min-height: 0;">

                @for (item of inProgressList; track item.id) {
                <div cdkDrag (cdkDragMoved)="onDragMove($event)" (cdkDragEnded)="onDragEnded()"
                    class="relative bg-white p-4 rounded-lg shadow-sm border-l-4 border-yellow-500 hover:shadow-md transition-shadow group">
                    <p class="text-gray-800 font-medium wrap-break-word pr-14">{{ item.title }}</p>

                    <div class="flex items-center justify-between mt-2 text-xs">
                        <div class="flex items-center gap-1 text-gray-500">
                            <i class='bx bx-calendar'></i>
                            <span>Due : {{ item.dueDate | date:'MMM d' }}</span>
                        </div>

                        <span class="px-2 py-0.5 rounded-full font-semibold" [ngClass]="{
              'bg-red-100 text-red-700': item.priority === 'HIGH',
              'bg-yellow-100 text-yellow-700': item.priority === 'NORMAL',
              'bg-green-100 text-green-700': item.priority === 'LOW'
          }">
                            {{ item.priority }}
                        </span>
                    </div>

                    <div
                        class="absolute top-2 right-2 flex gap-2 opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-opacity">
                        <button (click)="edit(item)"
                            class="rounded-md bg-blue-50 hover:bg-blue-100 text-blue-600 shadow-sm cursor-pointer">
                            <i class='bx bx-edit text-base'></i>
                        </button>
                        <button (click)="delete(item)"
                            class="rounded-md bg-red-50 hover:bg-red-100 text-red-600 shadow-sm cursor-pointer">
                            <i class='bx bx-trash text-base'></i>
                        </button>
                    </div>
                </div>
                }

                @if (inProgressList.length === 0) {
                <div class="empty-state absolute inset-0 flex flex-col items-center justify-center text-center
                      pointer-events-none rounded-xl border-2 border-dashed
                      border-yellow-200 bg-yellow-50/40 px-4">

                    <p class="font-semibold text-gray-700 mb-1">No In Progress Tasks</p>
                    <p class="text-xs text-gray-500 mb-3">Tasks will appear here when they move into this stage.</p>

                    <button (click)="toggleDialog()"
                        class="pointer-events-auto mt-2 text-sm bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-1.5 rounded-md shadow-sm cursor-pointer">
                        + Add Task
                    </button>
                </div>
                }
            </div>
        </div>

        <!-- COMPLETED -->
        <div #col
            class="flex flex-col flex-1 min-w-70 bg-gray-100 rounded-xl shadow-sm border border-gray-200 overflow-hidden"
            style="min-width:320px; min-height:0; max-height:85vh;">
            <div class="p-4 border-b border-gray-200 flex justify-between items-center bg-white">
                <h3 class="font-bold text-green-600">Completed</h3>
                <span class="bg-green-100 text-green-600 text-xs px-2 py-1 rounded-full">
                    {{ completedList.length }}
                </span>
            </div>

            <div #list id="completedList" cdkDropList cdkScrollable [cdkDropListData]="completedList"
                class="relative flex-1 p-4 overflow-y-auto space-y-3 min-h-60" (cdkDropListDropped)="drop($event)"
                style="min-height: 0;">

                @for (item of completedList; track item.id) {
                <div cdkDrag (cdkDragMoved)="onDragMove($event)" (cdkDragEnded)="onDragEnded()"
                    class="relative bg-white p-4 rounded-lg shadow-sm border-l-4 border-green-500 hover:shadow-md transition-shadow group">
                    <p class="text-gray-800 font-medium wrap-break-word pr-14">{{ item.title }}</p>

                    <div class="flex items-center justify-between mt-2 text-xs">
                        <div class="flex items-center gap-1 text-gray-500">
                            <i class='bx bx-calendar'></i>
                            <span>Due : {{ item.dueDate | date:'MMM d' }}</span>
                        </div>

                        <span class="px-2 py-0.5 rounded-full font-semibold" [ngClass]="{
              'bg-red-100 text-red-700': item.priority === 'HIGH',
              'bg-yellow-100 text-yellow-700': item.priority === 'NORMAL',
              'bg-green-100 text-green-700': item.priority === 'LOW'
          }">
                            {{ item.priority }}
                        </span>
                    </div>

                    <div
                        class="absolute top-2 right-2 flex gap-2 opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-opacity">
                        <button (click)="edit(item); $event.stopPropagation()"
                            class="rounded-md bg-blue-50 hover:bg-blue-100 text-blue-600 shadow-sm cursor-pointer">
                            <i class="bx bx-edit text-base"></i>
                        </button>
                        <button (click)="delete(item); $event.stopPropagation()"
                            class="rounded-md bg-red-50 hover:bg-red-100 text-red-600 shadow-sm cursor-pointer">
                            <i class="bx bx-trash text-base"></i>
                        </button>
                    </div>
                </div>
                }

                @if (completedList.length === 0) {
                <div class="empty-state absolute inset-0 flex flex-col items-center justify-center text-center
                      pointer-events-none rounded-xl border-2 border-dashed
                      border-green-200 bg-green-50/40 px-4">

                    <p class="font-semibold text-gray-700 mb-1">No Completed Tasks</p>
                    <p class="text-xs text-gray-500 mb-3">Finished tasks will live here.</p>

                    <button (click)="toggleDialog()"
                        class="pointer-events-auto mt-2 text-sm bg-green-600 hover:bg-green-700 text-white px-4 py-1.5 rounded-md shadow-sm cursor-pointer">
                        + Add Task
                    </button>
                </div>
                }
            </div>
        </div>

    </div>
</div>

<app-task-dialog [open]="isDialogClosed == false" (close)="toggleDialog()">
    <app-task-form [form]="taskForm" [dialogTitle]="dialogTitle()" [dialogDescription]="dialogDescription()"
        [dialogTitleColor]="dialogTitleColor()" [dialogSubmitText]="dialogSubmitText()" [isDeleting]="isDeleting()"
        [users]="users()" (submitForm)="submit()" (cancel)="cancelDialog()">
    </app-task-form>
</app-task-dialog>